---
format: gfm
title: "Date basics"
date: "2022-05-05"
---

## Overview

If you're lucky, R will recognize a date (Date) or a date/time (POSIXct) when it's imported. But many times you won't be lucky and will need to know how to convert what is imported into a date. 


```{r}
library(tidyverse)
library(lubridate)
```

## Converting strings to dates

To convert a string to a date you'll use either `as.Date()` (for dates) or `as.POSIXct()` (for date-times) and within either function, you'll use the `format` argument.

The `format` step tells R where to look for each piece of the date as it tries to convert the string into a date. So if you specify `format = "%d/%m/%Y`, R will expect the inputted string to follow the pattern DD/MM/YYYY. There is a comprehensive table of how to format different pieces of a date [here](https://www.r-bloggers.com/2013/08/date-formats-in-r/), but generally these will get you quite far:

| conversion | Description                       |
|------------|-----------------------------------|
| %d         | 2 digit day                       |
| %m         | 2 digit month                     |
| %b  or %h  | abbreviated month, ex: Jan, Feb   |
| %B         | full month, ex: January, February |
| %y         | two digit year, ex: 12, 14, 98    |
| %Y         | four digit year, ex: 2012, 2014, 1998 |

Once a variable is stored as a date in R, it will be formatted as YYYY-MM-DD

### Date conversion example 1

```{r}
date1 <- "01/01/1900"
class(date1)

date1_date <- as.Date(date1, format = "%d/%m/%Y")
date1_date
class(date1_date)
```

### Date conversion example 2 

```{r}
date2 <- "Jan01-00"
class(date2)

date2_date <- as.Date(date2, format = "%b%d-%y")
date2_date
class(date2_date)
```

### Date conversion example 3

```{r}
date3 <- "January, 01, 2000"
date3_date <- as.Date(date3, format = "%B, %d, %Y")
date3_date
````

### Date conversion example 4

```{r}
date4 <- "2000yr01mn01dt"
date4_date <- as.Date(date4, format = "%Yyr%mmn%ddt")
date4_date
```

## Dealing with dates from other sources

### Excel

If you read a date in from excel and there's one bad date in the column, it convert everything to a number that is the number of days since 12/30/1899. You can fix this by adding the `origin` argument to the `as.Date()` function. 

```{r}
excel <- "42000"
excel_date <- as.Date(as.numeric(excel), origin = "1899-12-30")
excel_date
```


## formatting dates to print out
format(Sys.Date(), format = "%d %B %Y")
format(Sys.Date(), format = "%m/%d/%Y")

sample_data2 <- sample_data %>%
  select(record_id, episode_date) %>%
  mutate(episode_date_print = format(episode_date, format = "%m/%d/%Y"))

str(sample_data2)

## converting dates in R
### if you want make your data long and you have dates + characters that you combine into one column, it will convert the dates into the number of days since 1/1/1970 and the posixct into the number of seconds from 1/1/1970
sample_data1 <- sample_data %>%
  select(record_id, matches("create_date|sex")) %>%
  gather(variable, value, matches("create_date|sex")) %>% 
  mutate(date_time = as.POSIXct(as.numeric(value), origin = "1970-01-01"),
         date = as.Date(as.numeric(value), origin = "1970-01-01"))

## timezones
date_time_gmt <- "2021-01-01T18:00:00"

# all in one
date_time_pdt_all <- with_tz(as.POSIXct(date_time_gmt, format = "%Y-%m-%dT%H:%M:%S", tz = "GMT"), tzone = "US/Pacific")

# step 1 - convert to posixct
class(date_time_gmt)
date_time_pdt_1 <- as.POSIXct(date_time_gmt, format = "%Y-%m-%dT%H:%M:%S", tz = "GMT")

# step 2 - convert to PDT
date_time_pdt_2 <- with_tz(date_time_pdt_1, tzone = "US/Pacific")
date_time_pdt_2
