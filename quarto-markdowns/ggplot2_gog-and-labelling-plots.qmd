---
format: gfm
title: "Grammar of graphics & labelling plots"
author: "Beth Jump"
date: "2025-06-26"
execute: 
  warning: false
---
  
## Grammar of graphics

[`ggplot2`](https://ggplot2.tidyverse.org/) charts are built according to the Grammar of Graphics. For more information, check out this [book](https://ggplot2-book.org/).

## Adding labels to plots 

When possible, you should add labels directly to plots instead of having a legend. We'll go through how to do that with the `palmgerpenguins::penguins` data set. 

```{r}
library(tidyverse)
library(lubridate)
library(palmerpenguins)
library(smcepi)

# look at the data
str(penguins)
```

Let's look at the number of penguins spotted by year.

```{r}
plot1 <- penguins %>% 
  mutate(year = as.integer(year)) %>%
  count(year, species) %>%
  ggplot() +
  geom_line(aes(x = year,
                y = n,
                group = species,
                color = species),
            linewidth = 1) +
  labs(title = "Number of penguins spotted per year by species",
       x = "",
       y = "")
plot1
```

This looks OK, but ideally we'd want to label the values directly on the plot. We can do that by isolating the points we want to label. For a line chart, we typically want to label the values that are farthest to the right. Here were are manipulating the data to only keep the last observation per group:

```{r}
labels <- penguins %>%
  count(year, species) %>%
  group_by(species) %>% 
  arrange(desc(year)) %>%
  slice(1) %>%
  ungroup()
labels
```

Now we'll add them to our plot with `geom_text()`. A couple of things to note:

* we have to specify which data we want to use (`data = labels`) because we're pulling the labels from the `labels` data frame and not the `penguins` data frame 
* `hjust = 0` makes it so the label starts at the point mapped in the `aes()` argument. If you don't use this, your label will be centered on the point which can make it hard to read
* `expand_limits()` allows you to expand the chart space past the default. This is helpful if the default space cuts off your labels. 

```{r}
plot2 <- plot1 +
  geom_text(data = labels,
            aes(x = year, 
                y = n,
                label = species,
                color = species),
            hjust = 0,
            fontface = "bold") + 
  theme_gg_smc(legend_loc = "none") +
  scale_x_continuous(breaks = c(2007, 2008, 2009)) + 
  expand_limits(x = c(2007, 2009.2))
plot2
```